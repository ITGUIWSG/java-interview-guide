- [1. 说说SpringCloud的工作原理](#1-说说SpringCloud的工作原理)
- [2. Eureka的心跳时间](#2-Eureka的心跳时间)
- [3. Eureka的缺点](#3-Eureka的缺点)
- [4. eureka缓存存在什么地方](#4-eureka缓存存在什么地方)
- [5. 说说分布式事务有哪些解决方案](#5-说说分布式事务有哪些解决方案)
- [6. rpc和http的区别](#6-rpc和http的区别)
## 1. 说说SpringCloud的工作原理
Spring Cloud是一个全家桶式的技术栈，包含了很多组件，其中比较核心的有Eureka、Ribbon、Feign、Hystrix、Zuul这几个组件。
- Eureka是微服务架构中的注册中心，专门负责服务的注册与发现。每个服务中都有一个Eureka Client组件，这个组件专门负责将这个服务的信息注册到Eureka Server中。说白了，就是告诉Eureka Server，自己在哪台机器上，监听着哪个端口。而Eureka Server是一个注册中心，里面有一个注册表，保存了各服务所在的机器和端口号。服务调用者调用对应服务时，它的Eureka Client组件会找Eureka Server查找对应的服务信息进行调用，然后就可以把这些相关信息从Eureka Server的注册表中拉取到自己本地缓存起来，方便下次调用。
  - Eureka Client：负责将这个服务的信息注册到Eureka Server中
  - Eureka Server：注册中心，里面有一个注册表，保存了各个服务所在的机器和端口号
- Feign基于动态代理机制，根据注解和选择的机器，拼接请求URL地址，发起请求。Feign的一个关键机制就是使用了动态代理。
  - 首先，如果你对某个接口定义了@FeignClient注解，Feign就会针对这个接口创建一个动态代理
  - 接着你要是调用那个接口，本质就是会调用 Feign创建的动态代理，这是核心中的核心
  - Feign的动态代理会根据你在接口上的@RequestMapping等注解，来动态构造出你要请求的服务的地址
  - 最后针对这个地址，发起请求、解析响应
- Ribbon的作用是负载均衡，会帮你在每次请求时选择一台机器，均匀的把请求分发到各个机器上。Ribbon的负载均衡默认使用的最经典的Round Robin轮询算法。而且，Ribbon是和Feign以及Eureka紧密协作，完成工作的。
  - 首先Ribbon从 Eureka Client里获取到对应的服务注册表，即知道了所有的服务都部署在了哪些机器上，在监听哪些端口号
  - 然后Ribbon就可以使用默认的Round Robin轮询算法，从中选择一台机器
  - Feign就会针对这台机器，构造并发起请求
- Hystrix是隔离、熔断以及降级的一个框架，发起请求是通过Hystrix的线程池来走的，不同的服务走不同的线程池，实现了不同服务调用的隔离，避免了服务雪崩的问题
- Zuul就是微服务网关，这个组件是负责网络路由的。一般微服务架构中都必然会设计一个网关在里面，像android、ios、pc前端、微信小程序、H5等等，不用去关心后端有几百个服务，就知道有一个网关，所有请求都往网关走，网关会根据请求中的一些特征，将请求转发给后端的各个服务。而且有了网关之后，可以做统一的降级、限流、认证授权、安全等功能。
## 2. Eureka的心跳时间
- Eureka的客户端默认每隔30s会向eureka服务端更新实例，注册中心也会定时进行检查，发现某个实例默认90s内没有再收到心跳，会注销此实例。但是这些时间间隔是可配置的。
- 不过注册中心还有一个保护模式,在这个保护模式下，他会认为是网络问题，不会注销任何过期的实例
## 3. Eureka的缺点
- 不满足CAP的一致性
- 停止维护了，2.0之后不开源
## 4. eureka缓存存在什么地方

## 5. 说说分布式事务有哪些解决方案
- 基于XA协议的两阶段提交方案
  - 第一阶段是表决阶段，所有参与者都将本事务能否成功的信息反馈发给协调者；第二阶段是执行阶段，协调者根据所有参与者的反馈，通知所有参与者，步调一致地在所有分支上提交或者回滚。
  - 缺点：两阶段提交方案锁定资源时间长，对性能影响很大，基本不适合解决微服务事务问题。
- TCC方案
  - TCC方案其实是两阶段提交的一种改进。其将整个业务逻辑的每个分支显式的分成了Try、Confirm、Cancel三个操作。Try部分完成业务的准备工作，confirm部分完成业务的提交，cancel部分完成事务的回滚。
  - 事务开始时，业务应用会向事务协调器注册启动事务。之后业务应用会调用所有服务的try接口，完成一阶段准备。之后事务协调器会根据try接口返回情况，决定调用confirm接口或者cancel接口。如果接口调用失败，会进行重试。
  - 缺点：1、对应用的侵入性强。业务逻辑的每个分支都需要实现try、confirm、cancel三个操作，应用侵入性较强，改造成本高。
  2、实现难度较大。需要按照网络状态、系统故障等不同的失败原因实现不同的回滚策略。为了满足一致性的要求，confirm和cancel接口必须实现幂等。
- 基于可靠消息的最终一致性方案
  - 消息一致性方案是通过消息中间件保证上、下游应用数据操作的一致性。基本思路是将本地操作和发送消息放在一个事务中，保证本地操作和消息发送要么两者都成功或者都失败。下游应用向消息系统订阅该消息，收到消息后执行相应操作。
  - 消息方案从本质上讲是将分布式事务转换为两个本地事务，然后依靠下游业务的重试机制达到最终一致性。基于消息的最终一致性方案对应用侵入性也很高，应用需要进行大量业务改造，成本较高。
- GTS
  - GTS是一款分布式事务中间件，由阿里巴巴中间件部门研发，可以为微服务架构中的分布式事务提供一站式解决方案。
  - 优点：性能超强、应用侵入性极低、完整解决方案、容错能力强
## 6. rpc和http的区别
- RPC主要是基于TCP/IP协议，而HTTP服务主要是基于HTTP协议
- RPC要比http更快，虽然底层都是socket，但是http协议的信息往往比较臃肿
- RPC实现较为复杂，http相对比较简单
- 灵活性来看，http更胜一筹，因为它不关心实现细节，跨平台、跨语言。
- 如果对效率要求更高，并且开发过程使用统一的技术栈，那么用RPC还是不错的。
- 如果需要更加灵活，跨语言、跨平台，显然http更合适
